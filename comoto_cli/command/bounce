#!/bin/bash

# TODO add the ability to bounce just a single webapp and/or the ability to bounce all three redline apps
# TODO add an -L option to suppress the logs
# TODO maybe this should go into the container command

. $COMOTO_CLI_ROOT/lib/print

_comoto_cli_command_summary='Restart containers'
_comoto_cli_command_usage='comoto_cli bounce [OPTIONS] [CONTAINER_SHORT_NAME]'

_comoto_cli_command_help() {
  cat <<EOF

If no args are given, all containers are down/up'ed via 'docker-compose'.
If passed a container short name, only that one container is bounced via
'docker restart'.

Options:
  -h, --help  Print this help and exit

Container Short Names:
  cg          Cycle Gear
  jp          J&P Cycles
  rz          RevZilla

EOF
}

_comoto_cli_command_completion() {
  local valid_args=$($COMOTO_CLI_ROOT/lib/container_name -l)
  [[ $# -gt 1 ]] && return 1
  COMPREPLY=( $(compgen -W "$valid_args" -- "$1") )
}

_comoto_cli_command_execute() {
  if [[ $# -eq 0 ]] ; then
    # TODO make sure all into calls to the cli use `comoto_cli` longform. Add this note to a "contributions" README
    subcommand="(comoto_cli cd monorepo && docker-compose down && docker-compose up -d) && comoto_cli logs"
  elif [[ $# -eq 1 ]] && container_name=$($COMOTO_CLI_ROOT/lib/container_name -z $1) ; then
    subcommand="(comoto_cli cd monorepo && docker restart $container_name) && comoto_cli logs"
  else
    print_usage_error
    exit 1
  fi

  print_and_eval_command "$subcommand"
}
